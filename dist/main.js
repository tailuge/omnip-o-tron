!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}((function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return o(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){
/* @license
 * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var n=function(e){var t="b",r="w",n=-1,o="p",i="n",a="b",s="r",u="q",l="k",c="pnbrqkPNBRQK",f="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",d=["1-0","0-1","1/2-1/2","*"],p={b:[16,32,17,15],w:[-16,-32,-17,-15]},v={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},h=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],g=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],m={p:0,n:1,b:2,r:3,q:4,k:5},b={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},w=7,k=6,P=1,_=0,C={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},E={w:[{square:C.a1,flag:y.QSIDE_CASTLE},{square:C.h1,flag:y.KSIDE_CASTLE}],b:[{square:C.a8,flag:y.QSIDE_CASTLE},{square:C.h8,flag:y.KSIDE_CASTLE}]},A=new Array(128),S={w:n,b:n},M=r,O={w:0,b:0},x=n,T=0,N=1,L=[],I={};function j(){A=new Array(128),S={w:n,b:n},M=r,O={w:0,b:0},x=n,T=0,N=1,L=[],I={},U(R())}function D(){q(f)}function q(e){var o=e.split(/\s+/),i=o[0],a=0;if(!K(e).valid)return!1;j();for(var s=0;s<i.length;s++){var u=i.charAt(s);if("/"===u)a+=8;else if(-1!=="0123456789".indexOf(u))a+=parseInt(u,10);else{var l=u<"a"?r:t;Q({type:u.toLowerCase(),color:l},ae(a)),a++}}return M=o[1],o[2].indexOf("K")>-1&&(O.w|=y.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(O.w|=y.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(O.b|=y.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(O.b|=y.QSIDE_CASTLE),x="-"===o[3]?n:C[o[3]],T=parseInt(o[4],10),N=parseInt(o[5],10),U(R()),!0}function K(e){var t="No errors.",r="FEN string must contain six space-delimited fields.",n="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",u="1st field (piece positions) does not contain 8 '/'-delimited rows.",l="1st field (piece positions) is invalid [consecutive numbers].",c="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",d="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:r};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:n};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:s};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:u};for(var h=0;h<v.length;h++){for(var g=0,m=!1,b=0;b<v[h].length;b++)if(isNaN(v[h][b])){if(!/^[prnbqkPRNBQK]$/.test(v[h][b]))return{valid:!1,error_number:9,error:c};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l};g+=parseInt(v[h][b],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:d}:{valid:!0,error_number:0,error:t}}function R(){for(var e=0,o="",i=C.a8;i<=C.h1;i++){if(null==A[i])e++;else{e>0&&(o+=e,e=0);var a=A[i].color,s=A[i].type;o+=a===r?s.toUpperCase():s.toLowerCase()}i+1&136&&(e>0&&(o+=e),i!==C.h1&&(o+="/"),e=0,i+=8)}var u="";O[r]&y.KSIDE_CASTLE&&(u+="K"),O[r]&y.QSIDE_CASTLE&&(u+="Q"),O[t]&y.KSIDE_CASTLE&&(u+="k"),O[t]&y.QSIDE_CASTLE&&(u+="q"),u=u||"-";var l=x===n?"-":ae(x);return[o,M,u,l,T,N].join(" ")}function B(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(I[e[t]]=e[t+1]);return I}function U(e){L.length>0||(e!==f?(I.SetUp="1",I.FEN=e):(delete I.SetUp,delete I.FEN))}function z(e){var t=A[C[e]];return t?{type:t.type,color:t.color}:null}function Q(e,t){if(!("type"in e&&"color"in e))return!1;if(-1===c.indexOf(e.type.toLowerCase()))return!1;if(!(t in C))return!1;var r=C[t];return(e.type!=l||S[e.color]==n||S[e.color]==r)&&(A[r]={type:e.type,color:e.color},e.type===l&&(S[e.color]=r),U(R()),!0)}function W(e,t,r,n,i){var a={color:M,from:t,to:r,flags:n,piece:e[t].type};return i&&(a.flags|=y.PROMOTION,a.promotion=i),e[r]?a.captured=e[r].type:n&y.EP_CAPTURE&&(a.captured=o),a}function F(e){function t(e,t,r,n,l){if(e[r].type!==o||oe(n)!==_&&oe(n)!==w)t.push(W(e,r,n,l));else for(var c=[u,s,a,i],f=0,d=c.length;f<d;f++)t.push(W(e,r,n,l,c[f]))}var r=[],n=M,l=se(n),c={b:P,w:k},f=C.a8,d=C.h1,h=!1,g=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in C))return[];f=d=C[e.square],h=!0}for(var m=f;m<=d;m++)if(136&m)m+=7;else{var b=A[m];if(null!=b&&b.color===n)if(b.type===o){var E=m+p[n][0];if(null==A[E]){t(A,r,m,E,y.NORMAL);E=m+p[n][1];c[n]===oe(m)&&null==A[E]&&t(A,r,m,E,y.BIG_PAWN)}for(T=2;T<4;T++){136&(E=m+p[n][T])||(null!=A[E]&&A[E].color===l?t(A,r,m,E,y.CAPTURE):E===x&&t(A,r,m,x,y.EP_CAPTURE))}}else for(var T=0,N=v[b.type].length;T<N;T++){var L=v[b.type][T];for(E=m;!(136&(E+=L));){if(null!=A[E]){if(A[E].color===n)break;t(A,r,m,E,y.CAPTURE);break}if(t(A,r,m,E,y.NORMAL),"n"===b.type||"k"===b.type)break}}}if(!h||d===S[n]){if(O[n]&y.KSIDE_CASTLE){var I=(j=S[n])+2;null!=A[j+1]||null!=A[I]||G(l,S[n])||G(l,j+1)||G(l,I)||t(A,r,S[n],I,y.KSIDE_CASTLE)}if(O[n]&y.QSIDE_CASTLE){var j;I=(j=S[n])-2;null!=A[j-1]||null!=A[j-2]||null!=A[j-3]||G(l,S[n])||G(l,j-1)||G(l,I)||t(A,r,S[n],I,y.QSIDE_CASTLE)}}if(!g)return r;var D=[];for(m=0,N=r.length;m<N;m++)te(r[m]),X(n)||D.push(r[m]),re();return D}function H(e,t){var r="";if(e.flags&y.KSIDE_CASTLE)r="O-O";else if(e.flags&y.QSIDE_CASTLE)r="O-O-O";else{var n=function(e,t){for(var r=F({legal:!t}),n=e.from,o=e.to,i=e.piece,a=0,s=0,u=0,l=0,c=r.length;l<c;l++){var f=r[l].from,d=r[l].to,p=r[l].piece;i===p&&n!==f&&o===d&&(a++,oe(n)===oe(f)&&s++,ie(n)===ie(f)&&u++)}if(a>0)return s>0&&u>0?ae(n):u>0?ae(n).charAt(1):ae(n).charAt(0);return""}(e,t);e.piece!==o&&(r+=e.piece.toUpperCase()+n),e.flags&(y.CAPTURE|y.EP_CAPTURE)&&(e.piece===o&&(r+=ae(e.from)[0]),r+="x"),r+=ae(e.to),e.flags&y.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return te(e),Z()&&(V()?r+="#":r+="+"),re(),r}function $(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function G(e,n){for(var i=C.a8;i<=C.h1;i++)if(136&i)i+=7;else if(null!=A[i]&&A[i].color===e){var a=A[i],s=i-n,u=s+119;if(h[u]&1<<m[a.type]){if(a.type===o){if(s>0){if(a.color===r)return!0}else if(a.color===t)return!0;continue}if("n"===a.type||"k"===a.type)return!0;for(var l=g[u],c=i+l,f=!1;c!==n;){if(null!=A[c]){f=!0;break}c+=l}if(!f)return!0}}return!1}function X(e){return G(se(e),S[e])}function Z(){return X(M)}function V(){return Z()&&0===F().length}function Y(){return!Z()&&0===F().length}function J(){for(var e={},t=[],r=0,n=0,o=C.a8;o<=C.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var s=A[o];s&&(e[s.type]=s.type in e?e[s.type]+1:1,s.type===a&&t.push(n),r++)}if(2===r)return!0;if(3===r&&(1===e[a]||1===e[i]))return!0;if(r===e[a]+2){var u=0,l=t.length;for(o=0;o<l;o++)u+=t[o];if(0===u||u===l)return!0}return!1}function ee(){for(var e=[],t={},r=!1;;){var n=re();if(!n)break;e.push(n)}for(;;){var o=R().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(r=!0),!e.length)break;te(e.pop())}return r}function te(e){var r=M,i=se(r);if(function(e){L.push({move:e,kings:{b:S.b,w:S.w},turn:M,castling:{b:O.b,w:O.w},ep_square:x,half_moves:T,move_number:N})}(e),A[e.to]=A[e.from],A[e.from]=null,e.flags&y.EP_CAPTURE&&(M===t?A[e.to-16]=null:A[e.to+16]=null),e.flags&y.PROMOTION&&(A[e.to]={type:e.promotion,color:r}),A[e.to].type===l){if(S[A[e.to].color]=e.to,e.flags&y.KSIDE_CASTLE){var a=e.to-1,s=e.to+1;A[a]=A[s],A[s]=null}else if(e.flags&y.QSIDE_CASTLE){a=e.to+1,s=e.to-2;A[a]=A[s],A[s]=null}O[r]=""}if(O[r])for(var u=0,c=E[r].length;u<c;u++)if(e.from===E[r][u].square&&O[r]&E[r][u].flag){O[r]^=E[r][u].flag;break}if(O[i])for(u=0,c=E[i].length;u<c;u++)if(e.to===E[i][u].square&&O[i]&E[i][u].flag){O[i]^=E[i][u].flag;break}x=e.flags&y.BIG_PAWN?"b"===M?e.to-16:e.to+16:n,e.piece===o?T=0:e.flags&(y.CAPTURE|y.EP_CAPTURE)?T=0:T++,M===t&&N++,M=se(M)}function re(){var e=L.pop();if(null==e)return null;var r=e.move;S=e.kings,M=e.turn,O=e.castling,x=e.ep_square,T=e.half_moves,N=e.move_number;var n,i,a=M,s=se(M);if(A[r.from]=A[r.to],A[r.from].type=r.piece,A[r.to]=null,r.flags&y.CAPTURE)A[r.to]={type:r.captured,color:s};else if(r.flags&y.EP_CAPTURE){var u;u=a===t?r.to-16:r.to+16,A[u]={type:o,color:s}}r.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)&&(r.flags&y.KSIDE_CASTLE?(n=r.to+1,i=r.to-1):r.flags&y.QSIDE_CASTLE&&(n=r.to-2,i=r.to+1),A[n]=A[i],A[i]=null);return r}function ne(e,t){var r=$(e);if(t){var n=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var o=n[1],i=n[2],a=n[3],s=n[4]}for(var u=F(),l=0,c=u.length;l<c;l++){if(r===$(H(u[l]))||t&&r===$(H(u[l],!0)))return u[l];if(n&&(!o||o.toLowerCase()==u[l].piece)&&C[i]==u[l].from&&C[a]==u[l].to&&(!s||s.toLowerCase()==u[l].promotion))return u[l]}return null}function oe(e){return e>>4}function ie(e){return 15&e}function ae(e){var t=ie(e),r=oe(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function se(e){return e===r?t:r}function ue(e){var t=function e(t){var r=t instanceof Array?[]:{};for(var n in t)r[n]="object"==typeof n?e(t[n]):t[n];return r}(e);t.san=H(t,!1),t.to=ae(t.to),t.from=ae(t.from);var r="";for(var n in y)y[n]&t.flags&&(r+=b[n]);return t.flags=r,t}function le(e){return e.replace(/^\s+|\s+$/g,"")}return q(void 0===e?f:e),{WHITE:r,BLACK:t,PAWN:o,KNIGHT:i,BISHOP:a,ROOK:s,QUEEN:u,KING:l,SQUARES:function(){for(var e=[],t=C.a8;t<=C.h1;t++)136&t?t+=7:e.push(ae(t));return e}(),FLAGS:b,load:function(e){return q(e)},reset:function(){return D()},moves:function(e){for(var t=F(e),r=[],n=0,o=t.length;n<o;n++)void 0!==e&&"verbose"in e&&e.verbose?r.push(ue(t[n])):r.push(H(t[n],!1));return r},in_check:function(){return Z()},in_checkmate:function(){return V()},in_stalemate:function(){return Y()},in_draw:function(){return T>=100||Y()||J()||ee()},insufficient_material:function(){return J()},in_threefold_repetition:function(){return ee()},game_over:function(){return T>=100||V()||Y()||J()||ee()},validate_fen:function(e){return K(e)},fen:function(){return R()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in I)n.push("["+i+' "'+I[i]+'"]'+t),o=!0;o&&L.length&&n.push(t);for(var a=[];L.length>0;)a.push(re());for(var s=[],u="";a.length>0;){var l=a.pop();L.length||"b"!==l.color?"w"===l.color&&(u.length&&s.push(u),u=N+"."):u=N+". ...",u=u+" "+H(l,!1),te(l)}if(u.length&&s.push(u),void 0!==I.Result&&s.push(I.Result),0===r)return n.join("")+s.join(" ");var c=0;for(i=0;i<s.length;i++)c+s[i].length>r&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(t),c=0):0!==i&&(n.push(" "),c++),n.push(s[i]),c+=s[i].length;return n.join("")},load_pgn:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy;function n(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[(.|"+n(o)+")*\\])("+n(o)+")*1.("+n(o)+"|.)*$","g"),a=e.replace(i,"$1");"["!==a[0]&&(a=""),D();var s=function(e,t){for(var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(n(r))),a="",s="",u=0;u<i.length;u++)a=i[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[u].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),le(a).length>0&&(o[a]=s);return o}(a,t);for(var u in s)B([u,s[u]]);if("1"===s.SetUp&&!("FEN"in s&&q(s.FEN)))return!1;var l=e.replace(a,"").replace(new RegExp(n(o),"g")," ");l=l.replace(/(\{[^}]+\})+?/g,"");for(var c=/(\([^\(\)]+\))+?/g;c.test(l);)l=l.replace(c,"");var f=le(l=(l=(l=l.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<f.length-1;v++){if(null==(p=ne(f[v],r)))return!1;te(p)}if(p=f[f.length-1],d.indexOf(p)>-1)(function(e){for(var t in e)return!0;return!1})(I)&&void 0===I.Result&&B(["Result",p]);else{if(null==(p=ne(p,r)))return!1;te(p)}return!0},header:function(){return B(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=C.a8;t<=C.h1;t++){if(0===ie(t)&&(e+=" "+"87654321"[oe(t)]+" |"),null==A[t])e+=" . ";else{var n=A[t].type;e+=" "+(A[t].color===r?n.toUpperCase():n.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return M},move:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy,n=null;if("string"==typeof e)n=ne(e,r);else if("object"==typeof e)for(var o=F(),i=0,a=o.length;i<a;i++)if(!(e.from!==ae(o[i].from)||e.to!==ae(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){n=o[i];break}if(!n)return null;var s=ue(n);return te(n),s},undo:function(){var e=re();return e?ue(e):null},clear:function(){return j()},put:function(e,t){return Q(e,t)},get:function(e){return z(e)},remove:function(e){return function(e){var t=z(e);return A[C[e]]=null,t&&t.type===l&&(S[t.color]=n),U(R()),t}(e)},perft:function(e){return function e(t){for(var r=F({legal:!1}),n=0,o=M,i=0,a=r.length;i<a;i++){if(te(r[i]),!X(o))if(t-1>0)n+=e(t-1);else n++;re()}return n}(e)},square_color:function(e){if(e in C){var t=C[e];return(oe(t)+ie(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],r=[],n=(void 0!==e&&"verbose"in e&&e.verbose);L.length>0;)t.push(re());for(;t.length>0;){var o=t.pop();n?r.push(ue(o)):r.push(H(o)),te(o)}return r}}};void 0!==r&&(r.Chess=n)},{}],2:[function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0});var o=e("./util");function i(e,t){var r=e(t);return t.dom.redraw(),r}function a(e,t){return{key:e,pos:o.key2pos(e),piece:t}}r.anim=function(e,t){return t.animation.enabled?function(e,t){var r=n({},t.pieces),i=e(t),l=function(e,t){var r,n,i,s,u={},l=[],c={},f=[],d=[],p={};for(i in e)p[i]=a(i,e[i]);for(var v=0,h=o.allKeys;v<h.length;v++){var g=h[v];r=t.pieces[g],n=p[g],r?n?o.samePiece(r,n.piece)||(f.push(n),d.push(a(g,r))):d.push(a(g,r)):n&&f.push(n)}return d.forEach((function(e){var t,r;t=e,r=f.filter((function(t){return o.samePiece(e.piece,t.piece)})),(n=r.sort((function(e,r){return o.distanceSq(t.pos,e.pos)-o.distanceSq(t.pos,r.pos)}))[0])&&(s=[n.pos[0]-e.pos[0],n.pos[1]-e.pos[1]],u[e.key]=s.concat(s),l.push(n.key))})),f.forEach((function(e){o.containsX(l,e.key)||(c[e.key]=e.piece)})),{anims:u,fadings:c}}(r,t);if(u(l.anims)&&u(l.fadings))t.dom.redraw();else{var c=t.animation.current&&t.animation.current.start;t.animation.current={start:s.now(),frequency:1/t.animation.duration,plan:l},c||function e(t,r){var n=t.animation.current;if(void 0===n)return void(t.dom.destroyed||t.dom.redrawNow());var i=1-(r-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{var a=(c=i)<.5?4*c*c*c:(c-1)*(2*c-2)*(2*c-2)+1;for(var u in n.plan.anims){var l=n.plan.anims[u];l[2]=l[0]*a,l[3]=l[1]*a}t.dom.redrawNow(!0),o.raf((function(r){return void 0===r&&(r=s.now()),e(t,r)}))}var c}(t,s.now())}return i}(e,t):i(e,t)},r.render=i;var s=void 0!==window.performance?window.performance:Date;function u(e){for(var t in e)return!1;return!0}},{"./util":17}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./fen"),i=e("./config"),a=e("./anim"),s=e("./drag"),u=e("./explosion");r.start=function(e,t){function r(){n.toggleOrientation(e),t()}return{set:function(t){t.orientation&&t.orientation!==e.orientation&&r(),(t.fen?a.anim:a.render)((function(e){return i.configure(e,t)}),e)},state:e,getFen:function(){return o.write(e.pieces)},toggleOrientation:r,setPieces:function(t){a.anim((function(e){return n.setPieces(e,t)}),e)},selectSquare:function(t,r){t?a.anim((function(e){return n.selectSquare(e,t,r)}),e):e.selected&&(n.unselect(e),e.dom.redraw())},move:function(t,r){a.anim((function(e){return n.baseMove(e,t,r)}),e)},newPiece:function(t,r){a.anim((function(e){return n.baseNewPiece(e,t,r)}),e)},playPremove:function(){if(e.premovable.current){if(a.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop:function(t){if(e.predroppable.current){var r=n.playPredrop(e,t);return e.dom.redraw(),r}return!1},cancelPremove:function(){a.render(n.unsetPremove,e)},cancelPredrop:function(){a.render(n.unsetPredrop,e)},cancelMove:function(){a.render((function(e){n.cancelMove(e),s.cancel(e)}),e)},stop:function(){a.render((function(e){n.stop(e),s.cancel(e)}),e)},explode:function(t){u.default(e,t)},setAutoShapes:function(t){a.render((function(e){return e.drawable.autoShapes=t}),e)},setShapes:function(t){a.render((function(e){return e.drawable.shapes=t}),e)},getKeyAtDomPos:function(t){return n.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds())},redrawAll:t,dragNewPiece:function(t,r,n){s.dragNewPiece(e,t,r,n)},destroy:function(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":2,"./board":4,"./config":6,"./drag":7,"./explosion":10,"./fen":11}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./premove");function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e&&setTimeout((function(){return e.apply(void 0,t)}),1)}function a(e){e.premovable.current&&(e.premovable.current=void 0,i(e.premovable.events.unset))}function s(e){var t=e.predroppable;t.current&&(t.current=void 0,i(t.events.unset))}function u(e,t,r){var o=e.pieces[t],a=e.pieces[r];if(t===r||!o)return!1;var s=a&&a.color!==o.color?a:void 0;return r==e.selected&&p(e),i(e.events.move,t,r,s),function(e,t,r){if(!e.autoCastle)return!1;var o=e.pieces[t];if(!o||"king"!==o.role)return!1;var i=n.key2pos(t);if(5!==i[0])return!1;if(1!==i[1]&&8!==i[1])return!1;var a,s,u,l=n.key2pos(r);if(7===l[0]||8===l[0])a=n.pos2key([8,i[1]]),s=n.pos2key([6,i[1]]),u=n.pos2key([7,i[1]]);else{if(3!==l[0]&&1!==l[0])return!1;a=n.pos2key([1,i[1]]),s=n.pos2key([4,i[1]]),u=n.pos2key([3,i[1]])}var c=e.pieces[a];return!(!c||"rook"!==c.role)&&(delete e.pieces[t],delete e.pieces[a],e.pieces[u]=o,e.pieces[s]=c,!0)}(e,t,r)||(e.pieces[r]=o,delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,i(e.events.change),s||!0}function l(e,t,r,o){if(e.pieces[r]){if(!o)return!1;delete e.pieces[r]}return i(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,i(e.events.change),e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),!0}function c(e,t,r){var o=u(e,t,r);return o&&(e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),e.animation.current=void 0),o}function f(e,t,r){if(h(e,t,r)){var a=c(e,t,r);if(a){var u=e.hold.stop();p(e);var l={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:u};return!0!==a&&(l.captured=a),i(e.movable.events.after,t,r,l),!0}}else!function(e,t,r){return t!==r&&g(e,t)&&n.containsX(o.default(e.pieces,t,e.premovable.castle),r)}(e,t,r)?v(e,r)||g(e,r)?(d(e,r),e.hold.start()):p(e):(!function(e,t,r,n){s(e),e.premovable.current=[t,r],i(e.premovable.events.set,t,r,n)}(e,t,r,{ctrlKey:e.stats.ctrlKey}),p(e));return!1}function d(e,t){e.selected=t,g(e,t)?e.premovable.dests=o.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function p(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function v(e,t){var r=e.pieces[t];return!!r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function h(e,t,r){return t!==r&&v(e,t)&&(e.movable.free||!!e.movable.dests&&n.containsX(e.movable.dests[t],r))}function g(e,t){var r=e.pieces[t];return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function m(e){a(e),s(e),p(e)}r.callUserFunction=i,r.toggleOrientation=function(e){e.orientation=n.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},r.reset=function(e){e.lastMove=void 0,p(e),a(e),s(e)},r.setPieces=function(e,t){for(var r in t){var n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}},r.setCheck=function(e,t){if(!0===t&&(t=e.turnColor),t)for(var r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r);else e.check=void 0},r.unsetPremove=a,r.unsetPredrop=s,r.baseMove=u,r.baseNewPiece=l,r.userMove=f,r.dropNewPiece=function(e,t,r,n){if(function(e,t,r){var n=e.pieces[t];return!!n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,r)||n){var o=e.pieces[t];delete e.pieces[t],l(e,o,r,n),i(e.movable.events.afterNewPiece,o.role,r,{predrop:!1})}else!function(e,t,r){var n=e.pieces[t],o=e.pieces[r];return!!n&&r&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,r)?(a(e),s(e)):function(e,t,r){a(e),e.predroppable.current={role:t,key:r},i(e.predroppable.events.set,t,r)}(e,e.pieces[t].role,r);delete e.pieces[t],p(e)},r.selectSquare=function(e,t,r){e.selected?e.selected!==t||e.draggable.enabled?(e.selectable.enabled||r)&&e.selected!==t?f(e,e.selected,t)&&(e.stats.dragged=!1):e.hold.start():(p(e),e.hold.cancel()):(v(e,t)||g(e,t))&&(d(e,t),e.hold.start()),i(e.events.select,t)},r.setSelected=d,r.unselect=p,r.canMove=h,r.isDraggable=function(e,t){var r=e.pieces[t];return!!r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))},r.playPremove=function(e){var t=e.premovable.current;if(!t)return!1;var r=t[0],n=t[1],o=!1;if(h(e,r,n)){var s=c(e,r,n);if(s){var u={premove:!0};!0!==s&&(u.captured=s),i(e.movable.events.after,r,n,u),o=!0}}return a(e),o},r.playPredrop=function(e,t){var r=e.predroppable.current,n=!1;return!!r&&(t(r)&&l(e,{role:r.role,color:e.movable.color},r.key)&&(i(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),n=!0),s(e),n)},r.cancelMove=m,r.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,m(e)},r.getKeyAtDomPos=function(e,t,r){var o=Math.ceil((e[0]-r.left)/r.width*8);t||(o=9-o);var i=Math.ceil(8-(e[1]-r.top)/r.height*8);return t||(i=9-i),o>0&&o<9&&i>0&&i<9?n.pos2key([o,i]):void 0}},{"./premove":12,"./util":17}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./api"),o=e("./config"),i=e("./state"),a=e("./wrap"),s=e("./events"),u=e("./render"),l=e("./svg"),c=e("./util");function f(e){var t=!1;return function(){t||(t=!0,c.raf((function(){e(),t=!1})))}}r.Chessground=function(e,t){var r=i.defaults();function d(){var t=r.dom&&r.dom.unbind;e.classList.add("cg-board-wrap");var n=c.memo((function(){return e.getBoundingClientRect()})),o=r.viewOnly&&!r.drawable.visible,i=a.default(e,r,o?void 0:n()),p=function(e){u.default(r),!e&&i.svg&&l.renderSvg(r,i.svg)};r.dom={elements:i,bounds:n,redraw:f(p),redrawNow:p,unbind:t,relative:o},r.drawable.prevSvgHash="",p(!1),s.bindBoard(r),t||(r.dom.unbind=s.bindDocument(r,d))}return o.configure(r,t||{}),d(),n.start(r,d)}},{"./api":3,"./config":6,"./events":9,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./fen");function i(e){return"object"==typeof e}r.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),function e(t,r){for(var n in r)i(t[n])&&i(r[n])?e(t[n],r[n]):t[n]=r[n]}(e,t),t.fen&&(e.pieces=o.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&n.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&n.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var r="white"===e.movable.color?1:8,a="e"+r,s=e.movable.dests[a],u=e.pieces[a];if(!s||!u||"king"!==u.role)return;e.movable.dests[a]=s.filter((function(e){return!(e==="a"+r&&-1!==s.indexOf("c"+r)||e==="h"+r&&-1!==s.indexOf("g"+r))}))}}},{"./board":4,"./fen":11}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./util"),i=e("./draw"),a=e("./anim");function s(e){o.raf((function(){var t=e.draggable.current;if(t){e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);var r=e.pieces[t.orig];if(r&&o.samePiece(r,t.piece)){if(!t.started&&o.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){var n=t.element();if(!n)return;t.element=n,t.element.cgDragging=!0,t.element.classList.add("dragging")}var i="white"===e.orientation,a=e.dom.bounds();t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]];var l=o.posToTranslateAbs(a)(t.origPos,i);l[0]+=t.pos[0]+t.dec[0],l[1]+=t.pos[1]+t.dec[1],o.translateAbs(t.element,l)}}else u(e);s(e)}}))}function u(e){var t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,n.unselect(e),l(e),e.dom.redraw())}function l(e){var t=e.dom.elements;t.ghost&&o.setVisible(t.ghost,!1)}function c(e,t,r){var n=o.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function f(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}r.start=function(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.preventDefault();var r="white"===e.orientation,u=e.dom.bounds(),l=o.eventPosition(t),d=n.getKeyAtDomPos(l,r,u);if(d){var p=e.pieces[d],v=e.selected;v||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.color===e.turnColor||i.clear(e);var h=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&n.canMove(e,e.selected,d)?a.anim((function(e){return n.selectSquare(e,d)}),e):n.selectSquare(e,d);var m=e.selected===d,b=f(e,d);if(p&&b&&m&&n.isDraggable(e,d)){var y=c(d,r,u);e.draggable.current={orig:d,origPos:o.key2pos(d),piece:p,rel:l,epos:l,pos:[0,0],dec:e.draggable.centerPiece?[l[0]-(y.left+y.width/2),l[1]-(y.top+y.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:v,originTarget:t.target},b.cgDragging=!0,b.classList.add("dragging");var w=e.dom.elements.ghost;w&&(w.className="ghost "+p.color+" "+p.role,o.translateAbs(w,o.posToTranslateAbs(u)(o.key2pos(d),r)),o.setVisible(w,!0)),s(e)}else h&&n.unsetPremove(e),g&&n.unsetPredrop(e);e.dom.redraw()}}},r.dragNewPiece=function(e,t,r,n){e.pieces.a0=t,e.dom.redraw();var i=o.eventPosition(r),a="white"===e.orientation,u=e.dom.bounds(),l=c("a0",a,u),d=[(a?0:7)*l.width+u.left,(a?8:-1)*l.height+u.top];e.draggable.current={orig:"a0",origPos:o.key2pos("a0"),piece:t,rel:d,epos:i,pos:[i[0]-d[0],i[1]-d[1]],dec:[-l.width/2,-l.height/2],started:!0,element:function(){return f(e,"a0")},originTarget:r.target,newPiece:!0,force:n||!1},s(e)},r.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=o.eventPosition(t))},r.end=function(e,t){var r=e.draggable.current;if(r)if("touchend"!==t.type||!r||r.originTarget===t.target||r.newPiece){n.unsetPremove(e),n.unsetPredrop(e);var i=o.eventPosition(t)||r.epos,a=n.getKeyAtDomPos(i,"white"===e.orientation,e.dom.bounds());a&&r.started?r.newPiece?n.dropNewPiece(e,r.orig,a,r.force):(e.stats.ctrlKey=t.ctrlKey,n.userMove(e,r.orig,a)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[r.orig],n.callUserFunction(e.events.change)),(!r||r.orig!==r.previouslySelected||r.orig!==a&&a)&&e.selectable.enabled||n.unselect(e),l(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},r.cancel=u},{"./anim":2,"./board":4,"./draw":8,"./util":17}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./util"),i=["green","red","blue","yellow"];function a(e){o.raf((function(){var t=e.drawable.current;if(t){var r=n.getKeyAtDomPos(t.pos,"white"===e.orientation,e.dom.bounds());r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),a(e)}}))}function s(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function u(e){var t=e.shiftKey&&o.isRightButton(e)?1:0,r=e.altKey?2:0;return i[t+r]}function l(e){e.onChange&&e.onChange(e.shapes)}r.start=function(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),t.ctrlKey?n.unselect(e):n.cancelMove(e);var r=o.eventPosition(t),i=n.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());i&&(e.drawable.current={orig:i,pos:r,brush:u(t)},a(e))}},r.processDraw=a,r.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=o.eventPosition(t))},r.end=function(e){var t=e.drawable.current;t&&(t.mouseSq&&function(e,t){var r=function(e){return e.orig===t.orig&&e.dest===t.dest},n=e.shapes.filter(r)[0];n&&(e.shapes=e.shapes.filter((o=r,function(e){return!o(e)})));var o;n&&n.brush===t.brush||e.shapes.push(t);l(e)}(e.drawable,t),s(e))},r.cancel=s,r.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),l(e.drawable))}},{"./board":4,"./util":17}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./drag"),o=e("./draw"),i=e("./util");function a(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r)}}function s(e,t,r){return function(n){n.shiftKey||i.isRightButton(n)?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)}}r.bindBoard=function(e){if(!e.viewOnly){var t=e.dom.elements.board,r=function(e){return function(t){e.draggable.current?n.cancel(e):e.drawable.current?o.cancel(e):t.shiftKey||i.isRightButton(t)?e.drawable.enabled&&o.start(e,t):e.viewOnly||n.start(e,t)}}(e);t.addEventListener("touchstart",r),t.addEventListener("mousedown",r),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},r.bindDocument=function(e,t){var r=[];if(!e.dom.relative&&e.resizable){r.push(a(document.body,"chessground.resize",(function(){e.dom.bounds.clear(),i.raf(t)})))}if(!e.viewOnly){var u=s(e,n.move,o.move),l=s(e,n.end,o.end);["touchmove","mousemove"].forEach((function(e){return r.push(a(document,e,u))})),["touchend","mouseup"].forEach((function(e){return r.push(a(document,e,l))}));var c=function(){return e.dom.bounds.clear()};r.push(a(window,"scroll",c,{passive:!0})),r.push(a(window,"resize",c,{passive:!0}))}return function(){return r.forEach((function(e){return e()}))}}},{"./drag":7,"./draw":8,"./util":17}],10:[function(e,t,r){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((function(){n(e,2),setTimeout((function(){return n(e,void 0)}),120)}),120)}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./types");r.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};r.read=function(e){"start"===e&&(e=r.initial);for(var t={},o=8,a=0,s=0,u=e;s<u.length;s++){var l=u[s];switch(l){case" ":return t;case"/":if(0===--o)return t;a=0;break;case"~":var c=t[n.pos2key([a,o])];c&&(c.promoted=!0);break;default:var f=l.charCodeAt(0);if(f<57)a+=f-48;else{++a;var d=l.toLowerCase();t[n.pos2key([a,o])]={role:i[d],color:l===d?"black":"white"}}}}return t},r.write=function(e){return n.invRanks.map((function(t){return o.ranks.map((function(r){var o=e[n.pos2key([r,t])];if(o){var i=a[o.role];return"white"===o.color?i.toUpperCase():i}return"1"})).join("")})).join("/").replace(/1{2,}/g,(function(e){return e.length.toString()}))}},{"./types":16,"./util":17}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util");function o(e,t){return Math.abs(e-t)}var i=function(e,t,r,n){var i=o(e,r),a=o(t,n);return 1===i&&2===a||2===i&&1===a},a=function(e,t,r,n){return o(e,r)===o(t,n)},s=function(e,t,r,n){return e===r||t===n},u=function(e,t,r,n){return a(e,t,r,n)||s(e,t,r,n)};r.default=function(e,t,r){var l,c,f=e[t],d=n.key2pos(t);switch(f.role){case"pawn":c=f.color,l=function(e,t,r,n){return o(e,r)<2&&("white"===c?n===t+1||t<=2&&n===t+2&&e===r:n===t-1||t>=7&&n===t-2&&e===r)};break;case"knight":l=i;break;case"bishop":l=a;break;case"rook":l=s;break;case"queen":l=u;break;case"king":l=function(e,t,r){return function(i,a,s,u){return o(i,s)<2&&o(a,u)<2||r&&a===u&&a===("white"===e?1:8)&&(5===i&&(3===s||7===s)||n.containsX(t,s))}}(f.color,function(e,t){return Object.keys(e).filter((function(r){var n=e[r];return n&&n.color===t&&"rook"===n.role})).map((function(e){return n.key2pos(e)[0]}))}(e,f.color),r)}return n.allKeys.map(n.key2pos).filter((function(e){return(d[0]!==e[0]||d[1]!==e[1])&&l(d[0],d[1],e[0],e[1])})).map(n.pos2key)}},{"./util":17}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./util");function i(e){return"PIECE"===e.tagName}function a(e){return"SQUARE"===e.tagName}function s(e,t){for(var r in t)e.dom.elements.board.removeChild(t[r])}function u(e,t){var r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function l(e){return e.color+" "+e.role}function c(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}r.default=function(e){var t,r,f,d,p,v,h,g,m,b,y,w="white"===e.orientation,k=e.dom.relative?o.posToTranslateRel:o.posToTranslateAbs(e.dom.bounds()),P=e.dom.relative?o.translateRel:o.translateAbs,_=e.dom.elements.board,C=e.pieces,E=e.animation.current,A=E?E.plan.anims:{},S=E?E.plan.fadings:{},M=e.draggable.current,O=function(e){var t,r,n={};if(e.lastMove&&e.highlight.lastMove)for(t in e.lastMove)c(n,e.lastMove[t],"last-move");e.check&&e.highlight.check&&c(n,e.check,"check");if(e.selected&&(c(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(t in o)r=o[t],c(n,r,"move-dest"+(e.pieces[r]?" oc":""));var i=e.premovable.dests;if(i)for(t in i)r=i[t],c(n,r,"premove-dest"+(e.pieces[r]?" oc":""))}var a=e.premovable.current;if(a)for(t in a)c(n,a[t],"current-premove");else e.predroppable.current&&c(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(t in s.keys)c(n,s.keys[t],"exploding"+s.stage);return n}(e),x={},T={},N={},L={},I=Object.keys(C);for(f=_.firstChild;f;){if(t=f.cgKey,i(f))if(d=C[t],v=A[t],h=S[t],p=f.cgPiece,!f.cgDragging||M&&M.orig===t||(f.classList.remove("dragging"),P(f,k(n.key2pos(t),w)),f.cgDragging=!1),!h&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),d){if(v&&f.cgAnimating&&p===l(d))(B=n.key2pos(t))[0]+=v[2],B[1]+=v[3],f.classList.add("anim"),P(f,k(B,w));else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),P(f,k(n.key2pos(t),w)),e.addPieceZIndex&&(f.style.zIndex=u(n.key2pos(t),w)));p!==l(d)||h&&f.cgFading?h&&p===l(h)?(f.classList.add("fading"),f.cgFading=!0):N[p]?N[p].push(f):N[p]=[f]:x[t]=!0}else N[p]?N[p].push(f):N[p]=[f];else if(a(f)){var j=f.className;O[t]===j?T[t]=!0:L[j]?L[j].push(f):L[j]=[f]}f=f.nextSibling}for(var D in O)if(!T[D]){y=(b=L[O[D]])&&b.pop();var q=k(n.key2pos(D),w);if(y)y.cgKey=D,P(y,q);else{var K=n.createEl("square",O[D]);K.cgKey=D,P(K,q),_.insertBefore(K,_.firstChild)}}for(var R in I)if(r=C[t=I[R]],v=A[t],!x[t])if(m=(g=N[l(r)])&&g.pop()){m.cgKey=t,m.cgFading&&(m.classList.remove("fading"),m.cgFading=!1);var B=n.key2pos(t);e.addPieceZIndex&&(m.style.zIndex=u(B,w)),v&&(m.cgAnimating=!0,m.classList.add("anim"),B[0]+=v[2],B[1]+=v[3]),P(m,k(B,w))}else{var U=l(r),z=n.createEl("piece",U);B=n.key2pos(t);z.cgPiece=U,z.cgKey=t,v&&(z.cgAnimating=!0,B[0]+=v[2],B[1]+=v[3]),P(z,k(B,w)),e.addPieceZIndex&&(z.style.zIndex=u(B,w)),_.appendChild(z)}for(var Q in N)s(e,N[Q]);for(var Q in L)s(e,L[Q])}},{"./util":17}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");r.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":11,"./util":17}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=e("./util");function i(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function a(e,t,r){var n,o=e.orig,i=e.dest,a=e.brush,u=e.piece,l=e.modifiers;return[r,o,i,a,i&&t[i]>1,u&&s(u),l&&(n=l,""+(n.lineWidth||""))].filter((function(e){return e})).join("")}function s(e){return[e.color,e.role,e.scale].filter((function(e){return e})).join("")}function u(e){var t=l(i("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(l(i("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function l(e,t){for(var r in t)e.setAttribute(r,t[r]);return e}function c(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function f(e,t){var r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter((function(e){return e})).join(""),r}function d(e,t,r){return(e.lineWidth||10)*(t?.85:1)/512*r.width}function p(e,t){return(e.opacity||1)*(t?.9:1)}function v(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}r.createElement=i,r.renderSvg=function(e,t){var r=e.drawable,s=r.current,h=s&&s.mouseSq?s:void 0,g={};r.shapes.concat(r.autoShapes).concat(h?[h]:[]).forEach((function(e){e.dest&&(g[e.dest]=(g[e.dest]||0)+1)}));var m=r.shapes.concat(r.autoShapes).map((function(e){return{shape:e,current:!1,hash:a(e,g,!1)}}));h&&m.push({shape:h,current:!0,hash:a(h,g,!0)});var b=m.map((function(e){return e.hash})).join("");if(b!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=b;var y=t.firstChild;!function(e,t,r){var n,o={};t.forEach((function(t){t.shape.dest&&(n=e.brushes[t.shape.brush],t.shape.modifiers&&(n=f(n,t.shape.modifiers)),o[n.key]=n)}));var i={},a=r.firstChild;for(;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||r.appendChild(u(o[s]))}(r,m,y),function(e,t,r,a,s,u){void 0===n&&(n=o.computeIsTrident());var h=e.dom.bounds(),g={},m=[];t.forEach((function(e){g[e.hash]=!1}));var b,y=u.nextSibling;for(;y;)b=y.getAttribute("cgHash"),g.hasOwnProperty(b)?g[b]=!0:m.push(y),y=y.nextSibling;m.forEach((function(e){return s.removeChild(e)})),t.forEach((function(t){g[t.hash]||s.appendChild(function(e,t,r,a,s){var u,h=t.shape,g=t.current,m=t.hash;if(h.piece)u=function(e,t,r,n){var o=v(t,n),a=n.width/8*(r.scale||1),s=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return l(i("image"),{className:r.role+" "+r.color,x:o[0]-a/2,y:o[1]-a/2,width:a,height:a,href:e+s+".svg"})}(e.drawable.pieces.baseUrl,c(o.key2pos(h.orig),e.orientation),h.piece,s);else{var b=c(o.key2pos(h.orig),e.orientation);if(h.orig&&h.dest){var y=r[h.brush];h.modifiers&&(y=f(y,h.modifiers)),u=function(e,t,r,o,a,s){var u=function(e,t){return n?0:(t?20:10)/512*e.width}(s,a&&!o),c=v(t,s),f=v(r,s),h=f[0]-c[0],g=f[1]-c[1],m=Math.atan2(g,h),b=Math.cos(m)*u,y=Math.sin(m)*u;return l(i("line"),{stroke:e.color,"stroke-width":d(e,o,s),"stroke-linecap":"round","marker-end":n?void 0:"url(#arrowhead-"+e.key+")",opacity:p(e,o),x1:c[0],y1:c[1],x2:f[0]-b,y2:f[1]-y})}(y,b,c(o.key2pos(h.dest),e.orientation),g,a[h.dest]>1,s)}else u=function(e,t,r,n){var o=v(t,n),a=function(e){var t=e.width/512;return[3*t,4*t]}(n),s=(n.width+n.height)/32;return l(i("circle"),{stroke:e.color,"stroke-width":a[r?0:1],fill:"none",opacity:p(e,r),cx:o[0],cy:o[1],r:s-a[1]/2})}(r[h.brush],b,g,s)}return u.setAttribute("cgHash",m),u}(e,t,r,a,h))}))}(e,m,r.brushes,g,t,y)}}},{"./util":17}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});var o=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=(n=Array.prototype).concat.apply(n,o.files.map((function(e){return o.ranks.map((function(t){return e+t}))}))),r.pos2key=function(e){return r.allKeys[8*e[0]+e[1]-9]},r.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},r.memo=function(e){var t,r=function(){return void 0===t&&(t=e()),t};return r.clear=function(){t=void 0},r},r.timer=function(){var e;return{start:function(){e=Date.now()},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var t=Date.now()-e;return e=void 0,t}}},r.opposite=function(e){return"white"===e?"black":"white"},r.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)},r.distanceSq=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},r.samePiece=function(e,t){return e.role===t.role&&e.color===t.color},r.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1};var i=function(e,t,r,n){return[(t?e[0]-1:8-e[0])*r,(t?8-e[1]:e[1]-1)*n]};r.posToTranslateAbs=function(e){var t=e.width/8,r=e.height/8;return function(e,n){return i(e,n,t,r)}},r.posToTranslateRel=function(e,t){return i(e,t,12.5,12.5)},r.translateAbs=function(e,t){e.style.transform="translate("+t[0]+"px,"+t[1]+"px)"},r.translateRel=function(e,t){e.style.left=t[0]+"%",e.style.top=t[1]+"%"},r.setVisible=function(e,t){e.style.visibility=t?"visible":"hidden"},r.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},r.isRightButton=function(e){return 2===e.buttons||2===e.button},r.createEl=function(e,t){var r=document.createElement(e);return t&&(r.className=t),r},r.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./types"),i=e("./svg");function a(e,t){var r,o=n.createEl("coords",t);for(var i in e)(r=n.createEl("coord")).textContent=e[i],o.appendChild(r);return o}r.default=function(e,t,r){e.innerHTML="",e.classList.add("cg-board-wrap"),n.colors.forEach((function(r){e.classList.toggle("orientation-"+r,t.orientation===r)})),e.classList.toggle("manipulable",!t.viewOnly);var s,u,l=n.createEl("div","cg-board");if(e.appendChild(l),t.drawable.visible&&r&&((s=i.createElement("svg")).appendChild(i.createElement("defs")),e.appendChild(s)),t.coordinates){var c="black"===t.orientation?" black":"";e.appendChild(a(o.ranks,"ranks"+c)),e.appendChild(a(o.files,"files"+c))}return r&&t.draggable.showGhost&&(u=n.createEl("piece","ghost"),n.setVisible(u,!1),e.appendChild(u)),{board:l,ghost:u,svg:s}}},{"./svg":15,"./types":16,"./util":17}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./vnode"),o=e("./is");function i(e,t,r){var i,a,s,u={};if(void 0!==r?(u=t,o.array(r)?i=r:o.primitive(r)?a=r:r&&r.sel&&(i=[r])):void 0!==t&&(o.array(t)?i=t:o.primitive(t)?a=t:t&&t.sel?i=[t]:u=t),void 0!==i)for(s=0;s<i.length;++s)o.primitive(i[s])&&(i[s]=n.vnode(void 0,void 0,void 0,i[s],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||function e(t,r,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==r)for(var o=0;o<r.length;++o){var i=r[o].data;void 0!==i&&e(i,r[o].children,r[o].sel)}}(u,i,e),n.vnode(e,u,i,a,void 0)}r.h=i,r.default=i},{"./is":21,"./vnode":28}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.htmlDomApi={createElement:function(e){return document.createElement(e)},createElementNS:function(e,t){return document.createElementNS(e,t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,r){e.insertBefore(t,r)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType}},r.default=r.htmlDomApi},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.array=Array.isArray,r.primitive=function(e){return"string"==typeof e||"number"==typeof e}},{}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="http://www.w3.org/1999/xlink",o="http://www.w3.org/XML/1998/namespace",i=58,a=120;function s(e,t){var r,s=t.elm,u=e.data.attrs,l=t.data.attrs;if((u||l)&&u!==l){for(r in u=u||{},l=l||{}){var c=l[r];u[r]!==c&&(!0===c?s.setAttribute(r,""):!1===c?s.removeAttribute(r):r.charCodeAt(0)!==a?s.setAttribute(r,c):r.charCodeAt(3)===i?s.setAttributeNS(o,r,c):r.charCodeAt(5)===i?s.setAttributeNS(n,r,c):s.setAttribute(r,c))}for(r in u)r in l||s.removeAttribute(r)}}r.attributesModule={create:s,update:s},r.default=r.attributesModule},{}],23:[function(e,t,r){"use strict";function n(e,t){var r,n,o=t.elm,i=e.data.class,a=t.data.class;if((i||a)&&i!==a){for(n in a=a||{},i=i||{})a[n]||o.classList.remove(n);for(n in a)(r=a[n])!==i[n]&&o.classList[r?"add":"remove"](n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.classModule={create:n,update:n},r.default=r.classModule},{}],24:[function(e,t,r){"use strict";function n(e,t){var r=e.type,n=t.data.on;n&&n[r]&&function e(t,r,n){if("function"==typeof t)t.call(r,n,r);else if("object"==typeof t)if("function"==typeof t[0])if(2===t.length)t[0].call(r,t[1],n,r);else{var o=t.slice(1);o.push(n),o.push(r),t[0].apply(r,o)}else for(var i=0;i<t.length;i++)e(t[i],r,n)}(n[r],t,e)}function o(e,t){var r,o=e.data.on,i=e.listener,a=e.elm,s=t&&t.data.on,u=t&&t.elm;if(o!==s){if(o&&i)if(s)for(r in o)s[r]||a.removeEventListener(r,i,!1);else for(r in o)a.removeEventListener(r,i,!1);if(s){var l=t.listener=e.listener||function e(t){n(t,e.vnode)};if(l.vnode=t,o)for(r in s)o[r]||u.addEventListener(r,l,!1);else for(r in s)u.addEventListener(r,l,!1)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.eventListenersModule={create:o,update:o,destroy:o},r.default=r.eventListenersModule},{}],25:[function(e,t,r){"use strict";function n(e,t){var r,n,o=t.elm,i=e.data.props,a=t.data.props;if((i||a)&&i!==a){for(r in a=a||{},i=i||{})a[r]||delete o[r];for(r in a)n=a[r],i[r]===n||"value"===r&&o[r]===n||(o[r]=n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.propsModule={create:n,update:n},r.default=r.propsModule},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./vnode"),o=e("./is"),i=e("./htmldomapi");function a(e){return void 0===e}function s(e){return void 0!==e}var u=n.default("",{},[],void 0,void 0);function l(e,t){return e.key===t.key&&e.sel===t.sel}function c(e,t,r){var n,o,i,a={};for(n=t;n<=r;++n)null!=(i=e[n])&&void 0!==(o=i.key)&&(a[o]=n);return a}var f=["create","update","remove","destroy","pre","post"],d=e("./h");r.h=d.h;var p=e("./thunk");r.thunk=p.thunk,r.init=function(e,t){var r,d,p={},v=void 0!==t?t:i.default;for(r=0;r<f.length;++r)for(p[f[r]]=[],d=0;d<e.length;++d){var h=e[d][f[r]];void 0!==h&&p[f[r]].push(h)}function g(e,t){return function(){if(0==--t){var r=v.parentNode(e);v.removeChild(r,e)}}}function m(e,t){var r,n=e.data;void 0!==n&&s(r=n.hook)&&s(r=r.init)&&(r(e),n=e.data);var i=e.children,l=e.sel;if("!"===l)a(e.text)&&(e.text=""),e.elm=v.createComment(e.text);else if(void 0!==l){var c=l.indexOf("#"),f=l.indexOf(".",c),d=c>0?c:l.length,h=f>0?f:l.length,g=-1!==c||-1!==f?l.slice(0,Math.min(d,h)):l,b=e.elm=s(n)&&s(r=n.ns)?v.createElementNS(r,g):v.createElement(g);for(d<h&&b.setAttribute("id",l.slice(d+1,h)),f>0&&b.setAttribute("class",l.slice(h+1).replace(/\./g," ")),r=0;r<p.create.length;++r)p.create[r](u,e);if(o.array(i))for(r=0;r<i.length;++r){var y=i[r];null!=y&&v.appendChild(b,m(y,t))}else o.primitive(e.text)&&v.appendChild(b,v.createTextNode(e.text));s(r=e.data.hook)&&(r.create&&r.create(u,e),r.insert&&t.push(e))}else e.elm=v.createTextNode(e.text);return e.elm}function b(e,t,r,n,o,i){for(;n<=o;++n){var a=r[n];null!=a&&v.insertBefore(e,m(a,i),t)}}function y(e){var t,r,n=e.data;if(void 0!==n){for(s(t=n.hook)&&s(t=t.destroy)&&t(e),t=0;t<p.destroy.length;++t)p.destroy[t](e);if(void 0!==e.children)for(r=0;r<e.children.length;++r)null!=(t=e.children[r])&&"string"!=typeof t&&y(t)}}function w(e,t,r,n){for(;r<=n;++r){var o=void 0,i=void 0,a=void 0,u=t[r];if(null!=u)if(s(u.sel)){for(y(u),i=p.remove.length+1,a=g(u.elm,i),o=0;o<p.remove.length;++o)p.remove[o](u,a);s(o=u.data)&&s(o=o.hook)&&s(o=o.remove)?o(u,a):a()}else v.removeChild(e,u.elm)}}function k(e,t,r){var n,o;s(n=t.data)&&s(o=n.hook)&&s(n=o.prepatch)&&n(e,t);var i=t.elm=e.elm,u=e.children,f=t.children;if(e!==t){if(void 0!==t.data){for(n=0;n<p.update.length;++n)p.update[n](e,t);s(n=t.data.hook)&&s(n=n.update)&&n(e,t)}a(t.text)?s(u)&&s(f)?u!==f&&function(e,t,r,n){for(var o,i,s,u=0,f=0,d=t.length-1,p=t[0],h=t[d],g=r.length-1,y=r[0],P=r[g];u<=d&&f<=g;)null==p?p=t[++u]:null==h?h=t[--d]:null==y?y=r[++f]:null==P?P=r[--g]:l(p,y)?(k(p,y,n),p=t[++u],y=r[++f]):l(h,P)?(k(h,P,n),h=t[--d],P=r[--g]):l(p,P)?(k(p,P,n),v.insertBefore(e,p.elm,v.nextSibling(h.elm)),p=t[++u],P=r[--g]):l(h,y)?(k(h,y,n),v.insertBefore(e,h.elm,p.elm),h=t[--d],y=r[++f]):(void 0===o&&(o=c(t,u,d)),a(i=o[y.key])?(v.insertBefore(e,m(y,n),p.elm),y=r[++f]):((s=t[i]).sel!==y.sel?v.insertBefore(e,m(y,n),p.elm):(k(s,y,n),t[i]=void 0,v.insertBefore(e,s.elm,p.elm)),y=r[++f]));(u<=d||f<=g)&&(u>d?b(e,null==r[g+1]?null:r[g+1].elm,r,f,g,n):w(e,t,u,d))}(i,u,f,r):s(f)?(s(e.text)&&v.setTextContent(i,""),b(i,null,f,0,f.length-1,r)):s(u)?w(i,u,0,u.length-1):s(e.text)&&v.setTextContent(i,""):e.text!==t.text&&(s(u)&&w(i,u,0,u.length-1),v.setTextContent(i,t.text)),s(o)&&s(n=o.postpatch)&&n(e,t)}}return function(e,t){var r,o,i,a=[];for(r=0;r<p.pre.length;++r)p.pre[r]();for(function(e){return void 0!==e.sel}(e)||(e=function(e){var t=e.id?"#"+e.id:"",r=e.className?"."+e.className.split(" ").join("."):"";return n.default(v.tagName(e).toLowerCase()+t+r,{},[],void 0,e)}(e)),l(e,t)?k(e,t,a):(o=e.elm,i=v.parentNode(o),m(t,a),null!==i&&(v.insertBefore(i,t.elm,v.nextSibling(o)),w(i,[e],0,0))),r=0;r<a.length;++r)a[r].data.hook.insert(a[r]);for(r=0;r<p.post.length;++r)p.post[r]();return t}}},{"./h":19,"./htmldomapi":20,"./is":21,"./thunk":27,"./vnode":28}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./h");function o(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}function i(e){var t=e.data;o(t.fn.apply(void 0,t.args),e)}function a(e,t){var r,n=e.data,i=t.data,a=n.args,s=i.args;if(n.fn===i.fn&&a.length===s.length){for(r=0;r<s.length;++r)if(a[r]!==s[r])return void o(i.fn.apply(void 0,s),t);o(e,t)}else o(i.fn.apply(void 0,s),t)}r.thunk=function(e,t,r,o){return void 0===o&&(o=r,r=t,t=void 0),n.h(e,{key:t,hook:{init:i,prepatch:a},fn:r,args:o})},r.default=r.thunk},{"./h":19}],28:[function(e,t,r){"use strict";function n(e,t,r,n,o){return{sel:e,data:t,children:r,text:n,elm:o,key:void 0===t?void 0:t.key}}Object.defineProperty(r,"__esModule",{value:!0}),r.vnode=n,r.default=n},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("snabbdom"),o=e("snabbdom/modules/class"),i=e("snabbdom/modules/attributes"),a=e("snabbdom/modules/props"),s=e("snabbdom/modules/eventlisteners"),u=function(){function e(e){this.patch=n.init([o.default,a.default,i.default,s.default]),this.puzzles=[],this.element=e}return e.prototype.setPuzzles=function(e){this.puzzles=e,this.redraw()},e.prototype.redraw=function(){this.vnode=this.patch(this.vnode||this.element,this.render(this.puzzles))},e.prototype.render=function(e){return n.h("div#chessground-examples",e.map((function(e){return e.render()})))},e}();r.Boards=u},{snabbdom:26,"snabbdom/modules/attributes":22,"snabbdom/modules/class":23,"snabbdom/modules/eventlisteners":24,"snabbdom/modules/props":25}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./position"),o=function(){function e(e){this.stockfishQueue=e}return e.prototype.analyse=function(e,t,r){console.log(r),this.stockfishQueue.enqueue(new n.Position(e.analysis.fen),t)},e}();r.Evaluate=o},{"./position":33}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e){this.event=e}return e.prototype.isComplete=function(){return!!e.completePattern.exec(this.event)},e.prototype.bestMove=function(){var t=e.completePattern.exec(this.event);return t?t[1]:""},e.prototype.pv=function(){var t=e.pvPattern.exec(this.event);return t?t[1].split(" "):[]},e.prototype.score=function(){var t=e.matePattern.exec(this.event);return t?this.scoreMate(t[1]):(t=e.centipawnPattern.exec(this.event))?this.scoreCp(t[1]):"noScore"},e.prototype.scoreCp=function(e){return e<150&&e>-150?"drawn":e>0?"win":"lose"},e.prototype.scoreMate=function(e){return e>0?"win":"lose"},e.matePattern=/score mate ([^ ]*) .*/,e.centipawnPattern=/score cp ([^ ]*) .*/,e.completePattern=/bestmove (....)/,e.pvPattern=/ pv (.*)/,e}();r.Event=n},{}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../src/util"),o=e("chess.js"),i=e("./puzzle"),a=e("./stockfishqueue"),s=e("./evaluate"),u=e("./boards");r.Boards=u.Boards;var l=e("./puzzle");r.Puzzle=l.Puzzle,r.puzzlesFrom=function(e,t){var r=new a.StockfishQueue(t,(function(){})),u=new s.Evaluate(r),l=new o.Chess(e);return n.successorStates(l).map((function(e){return new i.Puzzle(e,u)}))}},{"../src/util":36,"./boards":29,"./evaluate":30,"./puzzle":34,"./stockfishqueue":35,"chess.js":1}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){this.fen=e};r.Position=n},{}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("chess.js"),o=e("chessground"),i=e("./util"),a=e("snabbdom"),s=e("snabbdom/modules/class"),u=e("snabbdom/modules/attributes"),l=e("snabbdom/modules/props"),c=e("snabbdom/modules/eventlisteners"),f=function(){function e(e,t){var r=this;this.patch=a.init([s.default,l.default,u.default,c.default]),this.runUnit=function(e){var t=e.elm;t.className="cg-board-wrap",r.run(t)},this.analysis=e,this.chess=new n.Chess(this.analysis.fen),this.evaluate=t,this.config=this.initialiseConfig()}return e.prototype.initialiseConfig=function(){var e=i.toColor(this.chess);return{orientation:e,turnColor:e,fen:this.analysis.fen,movable:{color:e,free:!1,dests:i.toDests(this.chess)}}},e.prototype.render=function(){var e=this;return a.h("section.blue.merida",{hook:{insert:function(t){e.vnode=t}}},[a.h("div.cg-board-wrap",{hook:{insert:this.runUnit}}),a.h("p",a.h("a",{props:{href:this.url(this.analysis),target:"_blank"}},this.analysis.judgment.name))])},e.prototype.redraw=function(){this.vnode=this.patch(this.vnode,this.render())},e.prototype.run=function(e){var t=this,r=o.Chessground(e,this.config);return this.originalMove(r),r.set({movable:{events:{after:function(e,n){t.moveAndResult(r,e,n)}}},events:{select:function(e){t.originalMove(r)}}}),r},e.prototype.originalMove=function(e){e.set({drawable:{shapes:[this.arrow(this.analysis.move,"red")]}})},e.prototype.moveAndResult=function(e,t,r){this.chess.move({from:t,to:r}),e.set({turnColor:i.toColor(this.chess),movable:{color:i.toColor(this.chess),dests:i.toDests(this.chess)},drawable:{shapes:[{orig:t,dest:r,brush:"yellow"}]}}),this.analysis.judgment.name="...",console.log("redraw"),this.redraw(),this.triggerEvaluations(this)},e.prototype.updateAnalysis=function(){this.analysis.judgment.name="+2.0 --\x3e",console.log("update"),this.redraw()},e.prototype.triggerEvaluations=function(e){e.evaluate.analyse(e,(function(){return e.updateAnalysis()}),(function(){return e.updateAnalysis()}))},e.prototype.arrow=function(e,t){return{orig:e.from,dest:e.to,brush:t}},e.prototype.url=function(e){return"https://lichess.org/"+e.id},e}();r.Puzzle=f},{"./util":36,"chess.js":1,chessground:5,snabbdom:26,"snabbdom/modules/attributes":22,"snabbdom/modules/class":23,"snabbdom/modules/eventlisteners":24,"snabbdom/modules/props":25}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./event"),o=function(e,t){this.position=e,this.onComplete=t},i=function(){function e(e,t){var r=this;this.workItems=[],this.stockfish=e,this.log=t,this.depth=8,this.send("setoption name MultiPV value 1"),this.stockfish.addEventListener("message",(function(e){r.sfEventHandler(e.data)}))}return e.prototype.sfEventHandler=function(e){var t=new n.Event(e);if(0!=this.workItems.length){if(t.isComplete()){var r=this.workItems.shift();return r.position.bestMove=t.bestMove(),this.log(r.position),r.onComplete(r.position),void(this.workItems.length>0&&this.processNextWorkItem())}var o=t.score();if("noScore"!=o)return this.workItems[0].position.score=o,void(this.workItems[0].position.pv=t.pv());this.log("ignored event: "+e)}},e.prototype.enqueue=function(e,t){this.workItems.push(new o(e,t)),1==this.workItems.length&&this.processNextWorkItem()},e.prototype.processNextWorkItem=function(){var e=this.workItems[0].position.fen;this.send("position fen "+e),this.send("go depth "+this.depth)},e.prototype.send=function(e){this.stockfish.postMessage(e),this.log(e)},e}();r.StockfishQueue=i},{"./event":31}],36:[function(e,t,r){"use strict";function n(e,t){e.move(t);var r=e.fen();return e.undo(),{fen:r,move:t,judgment:{name:t.san}}}Object.defineProperty(r,"__esModule",{value:!0}),r.toDests=function(e){var t={};return e.SQUARES.forEach((function(r){var n=e.moves({square:r,verbose:!0});n.length&&(t[r]=n.map((function(e){return e.to})))})),t},r.toColor=function(e){return"w"===e.turn()?"white":"black"},r.repairFen=function(e,t){return e.split(" ")[0]+("w"==t?" w - - 0 2":" b - - 0 1")},r.successorStates=function(e){return e.moves({verbose:!0}).map((function(t){return n(e,t)}))},r.nextState=n},{}]},{},[32])(32)}));